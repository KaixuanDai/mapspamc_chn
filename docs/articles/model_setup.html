<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model setup • mapspamc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model setup">
<meta property="og:description" content="mapspamc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapspamc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Background</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/crop_distribution_maps.html">Crop distribution maps</a>
        </li>
        <li>
          <a href="../articles/model_description.html">Model description</a>
        </li>
        <li>
          <a href="../articles/data.html">Input data</a>
        </li>
        <li>
          <a href="../articles/appendix.html">Appendix</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Preparation</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/input_data_collection.html">Input data collection</a>
        </li>
        <li>
          <a href="../articles/template.html">Country examples/templates</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Run mapspamc</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/model_setup.html">1. Model setup</a>
        </li>
        <li>
          <a href="../articles/process_subnational_statistics.html">2. Pre-processing</a>
        </li>
        <li>
          <a href="../articles/process_spatial_data.html">3. Process spatial data</a>
        </li>
        <li>
          <a href="../articles/create_synergy_cropland.html">4. Create synergy cropland map</a>
        </li>
        <li>
          <a href="../articles/create_synergy_irrigated_area.html">5. Create synergy irrigated area map</a>
        </li>
        <li>
          <a href="../articles/combine_input_data.html">6. Combine input data</a>
        </li>
        <li>
          <a href="../articles/run_model.html">7. Run model</a>
        </li>
        <li>
          <a href="../articles/post_process.html">8. Post-processing</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/michielvandijk/mapspamc" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model setup</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/michielvandijk/mapspamc/blob/HEAD/vignettes/model_setup.Rmd" class="external-link"><code>vignettes/model_setup.Rmd</code></a></small>
      <div class="hidden name"><code>model_setup.Rmd</code></div>

    </div>

    
    
<p>To setup SPAM-C several steps need to be taken. By now, we assume
that all required software is <a href="installation.html">installed</a>
and working. It is by far the easiest to create a new RStudio project
and use the mapspamc_mwi repository for Malawi as a <a href="template.html">template</a> as a basis of your country SPAM-C
version. All the steps described in the Articles run SPAM-C section use
the code in mapspamc_mwi repository as an example code so there is no
need to start from scratch. All scripts related to model setup can be
found in the <code>01_model_setup</code> folder of the template. The
most important is that you change the location on your hard disk where
the model will be stored and set the model parameters (see below), which
is done in the script <code>01_model_setup.r</code> in the template. As
the model parameters are needed as input in nearly all functions, this
particular script is always loaded at the beginning of all the other
scripts using the <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> command. In this way, you only
have to setup up the model once. It also ensures all the necessary
packages are loaded into R.</p>
<div class="section level2">
<h2 id="set-model-parameters-and-location-of-files">Set model parameters and location of files<a class="anchor" aria-label="anchor" href="#set-model-parameters-and-location-of-files"></a>
</h2>
<p>Nearly all functions in <code>mapspamc</code> need input on (1) key
parameters that determine the design of the model and how it will be
solved and (2) the location of raw and intermediate data, which will be
further processed. Both pieces of information are bundled in a
<code>spamc_par</code> object that is created by the function
<code>set_spamc_par()</code>. Another piece of information that is also
stored in the <code>spamc_par</code> object is the coordinate reference
system of the maps. This is automatically set to WSG84 (epsg:4326).</p>
<p>The following model parameters need to be set before SPAM-C can be
run:</p>
<ul>
<li><p><strong>iso3c country code (<code>iso3c</code>).</strong> The
three letter ISO 3166-1 alpha-3 country code, also referred to as iso3c
is used to extract national statistics from global datasets. A list of
country codes can be found in <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3" class="external-link">Wikipedia</a>.</p></li>
<li><p><strong>Year (<code>year</code>).</strong> The year (four digits)
will be used to select relevant global datasets when data is available
for multiple years, in particular the FAOSTAT national statistics,
population maps and and travel time maps. It is also useful to
distinguish SPAM-C output when the model is used to create crop
distribution maps for multiple years. (see <a href="process_subnat_stat.html">spatial data</a>).</p></li>
<li><p><strong>Spatial resolution (<code>res</code>).</strong> The user
can choose between two spatial resolutions: 30 arcsec (~1x1 km at the
equator) by selecting <code>"30sec"</code> and 5 arcmin (~10x10 km at
the equator) by selecting <code>"5min"</code>. Note that selecting a
resolution of 30 arcsec increases the model dimensions (number of grid
cells) by a factor 100! This might mean the model becomes too big to be
solved and/or your computer runs out of memory. We recommend
experimenting with the 5 arcmin resolution first!</p></li>
<li><p><strong>Depth of subnational statistics
(<code>adm_level</code>).</strong> This parameter sets the most detailed
level at which subnational administrative statistics are available.
Accepted inputs are <code>0</code> (only national level data),
<code>1</code> (national level and first level subnational data and
<code>2</code> (national level, first and second level subnational
data). In most cases first level data refers to states and province and
level 2 data indicates districts, counties and departments. However, in
the unusual case that you would have only national and county level data
for a country (i.e. there is no state or province data available), you
should set the adm_level parameter to 1 as the depth of your subnational
statistics is 1.</p></li>
<li><p><strong>Level at which the model is solved
(<code>solve_level</code>).</strong> The model can be solved at the
national level (<code>0</code>) or at the subnational level 1
(<code>1</code>). In the first case, all grid cells are optimized using
national level constraints. This means that for crops for which no
subnational level information is available, the national physical crop
area will be distributed over the whole country, subject to the standard
model constraints. In the latter case, the model is split into smaller
administrative level 1 models, which are solved separately. Breaking up
the model in smaller pieces will result in less complex and less memory
intensive models, which are easier to solve. The disadvantage is that
the subnatonal level models require <strong>full information</strong>
(i.e. harvested area statistics, cropping intensity statistics and
farmin system area shares) for all crops that are cultivated in the
country at administrative unit level 1. For most countries, the
subnational statistics tend to be incomplete and full crop information
is only available at the national level (from FAOSTAT). Hence, the only
way to run the model at administrative unit level 1 is to impute the
missing crop area values (e.g. by taking values for comparable crops for
which information is available, use national values or look for
secondary information). Running the model at administrative unit 1 level
is most useful for larger countries, such as China, Brazil and the USA,
for which subnational statistics coverage is high and models tend to be
large and complex due to the size of the country.</p></li>
<li><p><strong>Type of model (‘model’).</strong> You can choose between
two types of models: (1) minimization of cross-entropy (’“min_entropy”`)
and (2) maximization of fitness score. See the section on <a href="model_description.html">Model description</a> for
details.</p></li>
</ul>
<p>Similarly, the following two folders need to be defined when setting
up the model:</p>
<ul>
<li><p><strong>SPAM main folder location
(<code>spamc_path</code>).</strong> This folder will be used to store
all model related data, including processed data, mapping tables,
intermediate output, final results and, unless specified otherwise by
the user, the raw data.</p></li>
<li><p><strong>Raw data folder (<code>raw_path</code>).</strong>
Optionally the user can set a folder for the raw data. This might be
convenient if hard disk capacity is insufficient to store the several
gigabyte of data that are needed to store the global spatial datasets.
In this case, a data server could be used to store the data.</p></li>
</ul>
<p>The example below sets the SPAM-C parameters for Malawi and stores
them in an object called <code>param</code>. Param is an arbitrary name
but we recommend not to change it as we refer to <code>param</code> in
the documentation of most functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load mapspamc</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/michielvandijk/mapspamc" class="external-link">"mapspamc"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the folder where the model will be stored</span></span>
<span><span class="co"># Note that R uses forward slashes even in Windows!!</span></span>
<span><span class="va">mapspamc_path</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/dijk158/Dropbox/mapspamc_mwi"</span></span>
<span></span>
<span><span class="co"># Set SPAM-C parameters</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapspamc_par.html">mapspamc_par</a></span><span class="op">(</span>mapspamc_path <span class="op">=</span> <span class="va">mapspamc_path</span>,</span>
<span> iso3c <span class="op">=</span> <span class="st">"MWI"</span>,</span>
<span> year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span> res <span class="op">=</span> <span class="st">"5min"</span>,</span>
<span> adm_level <span class="op">=</span> <span class="fl">1</span>,</span>
<span> solve_level <span class="op">=</span> <span class="fl">0</span>,</span>
<span> model <span class="op">=</span> <span class="st">"max_score"</span><span class="op">)</span></span>
<span><span class="co">#&gt; raw_path is not defined, set to raw_data in main folder</span></span>
<span></span>
<span><span class="co"># Show parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span></span>
<span><span class="co">#&gt; country name:  Malawi </span></span>
<span><span class="co">#&gt; iso3n:  454 </span></span>
<span><span class="co">#&gt; iso3c:  MWI </span></span>
<span><span class="co">#&gt; continent:  Africa </span></span>
<span><span class="co">#&gt; year:  2010 </span></span>
<span><span class="co">#&gt; model:  max_score </span></span>
<span><span class="co">#&gt; resolution:  5min </span></span>
<span><span class="co">#&gt; adm level:  1 </span></span>
<span><span class="co">#&gt; solve level:  0 </span></span>
<span><span class="co">#&gt; mapspamc path:  </span></span>
<span><span class="co">#&gt; raw data path:  C:/Users/dijk158/Dropbox/mapspamc_mwi/raw_data </span></span>
<span><span class="co">#&gt; gams path:  </span></span>
<span><span class="co">#&gt; model folder:  max_score_5min_adm_level_1_solve_level_0 </span></span>
<span><span class="co">#&gt; crs:  epsg:4326</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-spam-c-folder-structure">Create SPAM-C folder structure<a class="anchor" aria-label="anchor" href="#create-spam-c-folder-structure"></a>
</h2>
<p><code>mapspamc</code> includes a function to create all necessary
folders <code><a href="../reference/create_folders.html">create_folders()</a></code>. The only input required is
<code>param</code> which contains all the model parameters. The function
will create three folders: (1) <code>raw_data</code> is created in the
main <code>spamc_path</code> unless indicated otherwise by the user and
serves to store all the raw input data, (2) <code>processed_data</code>
will be created in the main <code>mapspamc_path</code> and is used to
save all the intermediary data products as well as the final results and
(3) <code>mappings</code> will be created in the main
<code>mapspamc_path</code> and contains all the lists and mappings that
are needed to define the model (e.g. number crops) and harmonize various
data sources (concordance tables). All tables are in csv format and will
be created automatically into the <code>mappings</code> folder. Note
that it is possible to adjust some of these tables if needed
(e.g. adding a new crop). <code><a href="../reference/create_folders.html">create_folders()</a></code> will only create
csv files if the files do not exist. Hence, updated files will not be
overwritten. If for some reason you want to recreate the original
tables, simply remove the folder and/or files and they will be created
again when <code>create_spam_folders</code> is run.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create SPAM-C folder structure in the spamc_path</span></span>
<span><span class="fu"><a href="../reference/create_folders.html">create_folders</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-subnational-administrative-unit-map">Prepare subnational administrative unit map<a class="anchor" aria-label="anchor" href="#prepare-subnational-administrative-unit-map"></a>
</h2>
<p>To allocate subnational crop area information, a complementary map
(most likely in the form of a shapefile) with the location of the
subnational administrative units is needed. The processing of this map
cannot be captured by a single function as it involves several decisions
that need to be made by the user. These are explained next.</p>
<p>Before the shapefile can be processed you need to load it into R by
setting the name (in this case <code>adm_2010_MWI.shp</code>), which is
stored in the <code>raw_data/adm/</code> folder. The
<code>st_transform</code> command projects the map to WSG84 so that it
is consistent with all the other spatial data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># replace the name of the shapefile with that of your own country.</span></span>
<span><span class="va">iso3c_shp</span> <span class="op">&lt;-</span> <span class="st">"adm_2010_MWI.shp"</span></span>
<span></span>
<span><span class="co"># load shapefile</span></span>
<span><span class="va">adm_map_raw</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">mapspamc_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"raw_data/adm/{iso3c_shp}"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm_map_raw</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Project to standard global projection</span></span>
<span><span class="va">adm_map</span> <span class="op">&lt;-</span> <span class="va">adm_map_raw</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">crs</span><span class="op">)</span></span></code></pre></div>
<p>For the model to work, it is essential that the attribute table with
the names and codes of the administrative units has the correct column
names. To make this easier, you only have to specify the column names of
the attribute table which contain the names and code of the
(sub)national units and store them in the <code>admX_name_orig</code>
and <code>admX_code_orig</code> variables, respectively, where X is the
administrative unit level. If you only have data at level 0 and 1,
simply delete the lines of script that refer to administrative unit
level 2, etc. In case of Malawi, we have data at level 0, 1 and 2 so for
each level the column names for name and code need to be set. Columns in
the attribute table that are not relevant will be automatically deleted.
The script will also union all polygons with the same name and code.
Hence, if you only have statistics for the combination of two
subnational regions, simply give them the same name and code and they
will automatically be dissolved into one polygon.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the original names, i.e. the ones that will be replaced. Remove adm1</span></span>
<span><span class="co"># and/or adm2 entries if such data is not available.</span></span>
<span><span class="va">adm0_name_orig</span> <span class="op">&lt;-</span> <span class="st">"ADM0_NAME"</span></span>
<span><span class="va">adm0_code_orig</span> <span class="op">&lt;-</span> <span class="st">"FIPS0"</span></span>
<span><span class="va">adm1_name_orig</span> <span class="op">&lt;-</span> <span class="st">"ADM1_NAME"</span></span>
<span><span class="va">adm1_code_orig</span> <span class="op">&lt;-</span> <span class="st">"FIPS1"</span></span>
<span><span class="va">adm2_name_orig</span> <span class="op">&lt;-</span> <span class="st">"ADM2_NAME"</span></span>
<span><span class="va">adm2_code_orig</span> <span class="op">&lt;-</span> <span class="st">"FIPS2"</span></span>
<span></span>
<span><span class="co"># Replace the names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span> <span class="op">==</span> <span class="va">adm0_name_orig</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"adm0_name"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span> <span class="op">==</span> <span class="va">adm0_code_orig</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"adm0_code"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span> <span class="op">==</span> <span class="va">adm1_name_orig</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"adm1_name"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span> <span class="op">==</span> <span class="va">adm1_code_orig</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"adm1_code"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span> <span class="op">==</span> <span class="va">adm2_name_orig</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"adm2_name"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span> <span class="op">==</span> <span class="va">adm2_code_orig</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"adm2_code"</span></span>
<span></span>
<span><span class="co"># Only select relevant columns</span></span>
<span><span class="va">adm_map</span> <span class="op">&lt;-</span> <span class="va">adm_map</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">adm0_name</span>, <span class="va">adm0_code</span>, <span class="va">adm1_name</span>, <span class="va">adm1_code</span>, <span class="va">adm2_name</span>, <span class="va">adm2_code</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Union separate polygons that belong to the same adm    </span></span>
<span><span class="va">adm_map</span> <span class="op">&lt;-</span> <span class="va">adm_map</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">adm0_name</span>, <span class="va">adm0_code</span>, <span class="va">adm1_name</span>, <span class="va">adm1_code</span>, <span class="va">adm2_name</span>, <span class="va">adm2_code</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>adm0_name <span class="op">=</span> <span class="va">param</span><span class="op">$</span><span class="va">country</span>,</span>
<span>         adm0_code <span class="op">=</span> <span class="va">param</span><span class="op">$</span><span class="va">iso3c</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">)</span></span></code></pre></div>
<p>Polygons of administrative units where no crops should be allocated
must be removed. If this is not done and in the rare case when the area
statistics are larger than the cropland exent, the model might still
allocate crops into these regions. The Malawi shapefile includes two of
such regions. One is the Area under National Administration, which is
the part of Lake Malawi that belongs to Malawi and Likoma, several small
islands in lake Malawi that are not covered by the statistics. The
script below shows how to remove them. It there is no reason to remove
any polygons, simply delete the lines of script in the template. By
running <code><a href="../reference/create_adm_map_pdf.html">create_adm_map_pdf()</a></code> a pdf file with maps of the
(sub)national regions is created in the
<code>processed_data/maps/adm</code> folder. Finally, the script saves
the maps in shapefile and rds format in the relevant folder.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">$</span><span class="va">geometry</span>, main <span class="op">=</span> <span class="st">"ADM all polygons"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set names of ADMs that need to be removed from the polygon. </span></span>
<span><span class="va">adm1_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Area under National Administration"</span><span class="op">)</span></span>
<span><span class="va">adm2_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Likoma"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove ADMs</span></span>
<span><span class="va">adm_map</span> <span class="op">&lt;-</span> <span class="va">adm_map</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">adm1_name</span> <span class="op">!=</span> <span class="va">adm1_to_remove</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">adm2_name</span> <span class="op">!=</span> <span class="va">adm2_to_remove</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm_map</span><span class="op">$</span><span class="va">geometry</span>, main <span class="op">=</span> <span class="st">"ADM polygons removed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save adm maps</span></span>
<span><span class="va">temp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">mapspamc_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"processed_data/maps/adm/{param$res}"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">temp_path</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">adm_map</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"adm_map_{param$year}_{param$iso3c}.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">write_sf</span><span class="op">(</span><span class="va">adm_map</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_path</span>, <span class="fu">glue</span><span class="op">(</span><span class="st">"adm_map_{param$year}_{param$iso3c}.shp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create pdf file with the location of administrative units</span></span>
<span><span class="fu"><a href="../reference/create_adm_map_pdf.html">create_adm_map_pdf</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span></span></code></pre></div>
<p>To link the subnational statistics to other spatial data a mapping
table is needed (<code>adm_list</code>) that contains information on how
the administrative units at various levels are nested, which is exactly
the information that is stored in the attribute table of the
administrative unit map. The following code, extracts the list from the
shapefile and saves it as csv file in the
<code>processed_data/lists</code> folder.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create adm_list</span></span>
<span><span class="fu"><a href="../reference/create_adm_list.html">create_adm_list</a></span><span class="op">(</span><span class="va">adm_map</span>, <span class="va">param</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-grid-and-rasterize-subnational-administrative-unit-map">Create grid and rasterize subnational administrative unit map<a class="anchor" aria-label="anchor" href="#create-grid-and-rasterize-subnational-administrative-unit-map"></a>
</h2>
<p>The <code><a href="../reference/create_grid.html">create_grid()</a></code> function creates a spatial grid at
selected spatial resolution (i.e. 30 arcsec or 5 arcmin). The grid is
subsequently used by <code><a href="../reference/rasterize_adm_map.html">rasterize_adm_map()</a></code>, which rasterizes
the administrative unit map at the selected resolution. Both the grid
and the rasterized map are required by the model as input.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create grid</span></span>
<span><span class="fu"><a href="../reference/create_grid.html">create_grid</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rasterize administrative unit map</span></span>
<span><span class="fu"><a href="../reference/rasterize_adm_map.html">rasterize_adm_map</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span></span></code></pre></div>
<p>This is all it takes to set up the SPAM-C model! The next step is
processing the <a href="process_subnational_statistics.html">raw
subnational statistics</a> and <a href="process_spatial_data.html">spatial data</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michiel Van Dijk.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
